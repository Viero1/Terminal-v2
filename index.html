<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>MRKT AI Terminal</title>
    <meta name="theme-color" content="#0f1420">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MRKT AI">
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --bg: #0f1420;
            --panel: #151b2b;
            --text: #e6e9ef;
            --muted: #9aa4b2;
            --green: #00c851;
            --red: #ff4444;
            --yellow: #ffaa00;
            --blue: #2396ff;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            user-select: none;
            -webkit-user-select: none;
            overflow: hidden;
            height: 100vh;
        }
        
        .topbar {
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            background: #0b1020;
            border-bottom: 1px solid #1f2a44;
            z-index: 100;
            flex-shrink: 0;
        }
        
        .brand {
            font-weight: 700;
            font-size: 14px;
        }
        
        .status {
            font-size: 11px;
            color: var(--muted);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .live-dot {
            color: #ff3b30;
            font-size: 8px;
            animation: pulse 1.4s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .main-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 56px);
            overflow: hidden;
        }
        
        .symbol-bar {
            height: 40px;
            display: flex;
            gap: 8px;
            padding: 6px 10px;
            background: #0b1020;
            border-bottom: 1px solid #1f2a44;
            overflow-x: auto;
            overflow-y: hidden;
            flex-shrink: 0;
        }
        
        .symbol-btn {
            background: #151b2b;
            color: #9aa4b2;
            border: 1px solid #273151;
            border-radius: 4px;
            padding: 4px 10px;
            font-size: 11px;
            white-space: nowrap;
            cursor: pointer;
            transition: 0.2s;
            min-width: 60px;
        }
        
        .symbol-btn.active {
            background: var(--blue);
            color: #fff;
            border-color: var(--blue);
        }
        
        .chart-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .chart-header {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            background: var(--panel);
            border-bottom: 1px solid #1f2a44;
            font-size: 12px;
            flex-shrink: 0;
        }
        
        .tf-switch {
            display: flex;
            gap: 4px;
        }
        
        .tf-switch button {
            background: #11172a;
            color: #cfd6e4;
            border: 1px solid #273151;
            border-radius: 3px;
            padding: 3px 7px;
            font-size: 10px;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .tf-switch button.active {
            border-color: var(--blue);
            color: #fff;
            background: rgba(35, 150, 255, 0.1);
        }
        
        .chart-canvas {
            flex: 1;
            background: var(--panel);
            position: relative;
            overflow: hidden;
            touch-action: none;
        }
        
        #chart {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        .bottom-panels {
            height: 35vh;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            padding: 8px;
            overflow-y: auto;
            border-top: 1px solid #1f2a44;
            flex-shrink: 0;
        }
        
        .panel {
            background: var(--panel);
            border: 1px solid #1f2a44;
            border-radius: 6px;
            padding: 10px;
            font-size: 11px;
            overflow-y: auto;
        }
        
        .panel h3 {
            margin: 0 0 6px;
            font-size: 11px;
            color: #cfd6e4;
        }
        
        .panel-row {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
            font-size: 10px;
        }
        
        .zone-item {
            background: rgba(0, 200, 81, 0.1);
            border-left: 2px solid var(--green);
            padding: 4px 6px;
            margin: 3px 0;
            border-radius: 2px;
            font-size: 10px;
        }
        
        .zone-item.bearish {
            background: rgba(255, 68, 68, 0.1);
            border-left-color: var(--red);
        }
        
        .zone-price {
            font-weight: 600;
            color: var(--text);
        }
        
        .zone-conf {
            color: var(--yellow);
            font-size: 9px;
        }
        
        @media (max-width: 600px) {
            .bottom-panels {
                grid-template-columns: 1fr;
                height: 30vh;
            }
        }
    </style>
</head>
<body>
    <header class="topbar">
        <div class="brand">MRKT AI Terminal</div>
        <div class="status">
            <span class="live-dot">‚óè</span>
            <span>LIVE</span>
            <span id="price-label" style="margin-left: 8px; color: #d5def0; font-weight: 600;"></span>
        </div>
    </header>

    <div class="main-container">
        <!-- Symbol selector bar -->
        <div class="symbol-bar" id="symbol-bar">
            <!-- Buttons generated by JS -->
        </div>

        <!-- Chart area -->
        <div class="chart-container">
            <div class="chart-header">
                <span id="symbol-name">EURUSD</span>
                <div class="tf-switch" id="tf-switch">
                    <button data-tf="1m">1m</button>
                    <button data-tf="5m">5m</button>
                    <button data-tf="15m">15m</button>
                    <button data-tf="1h">1h</button>
                    <button data-tf="4h">4h</button>
                    <button data-tf="Daily" class="active">Daily</button>
                </div>
            </div>
            <div class="chart-canvas">
                <canvas id="chart"></canvas>
            </div>
        </div>

        <!-- Bottom analysis panels -->
        <div class="bottom-panels">
            <div class="panel">
                <h3>üìä Setup</h3>
                <div class="panel-row">
                    <span>Trend:</span>
                    <span id="setup-trend" style="font-weight: 600;">Bullish</span>
                </div>
                <div class="panel-row">
                    <span>Strength:</span>
                    <span id="setup-strength" style="font-weight: 600;">78%</span>
                </div>
                <div class="panel-row">
                    <span>Volatility:</span>
                    <span id="setup-vol" style="font-weight: 600;">Medium</span>
                </div>
                <div class="panel-row">
                    <span>RSI:</span>
                    <span id="setup-rsi" style="font-weight: 600;">58</span>
                </div>
            </div>

            <div class="panel">
                <h3>üéØ Entry Zones</h3>
                <div id="zones-panel"></div>
            </div>

            <div class="panel">
                <h3>üìà Indicators</h3>
                <div class="panel-row">
                    <span>MACD:</span>
                    <span id="ind-macd" style="font-weight: 600;">Bullish</span>
                </div>
                <div class="panel-row">
                    <span>RSI:</span>
                    <span id="ind-rsi" style="font-weight: 600;">58</span>
                </div>
                <div class="panel-row">
                    <span>MA20:</span>
                    <span id="ind-ma20" style="font-weight: 600;">Above</span>
                </div>
                <div class="panel-row">
                    <span>ADX:</span>
                    <span id="ind-adx" style="font-weight: 600;">42</span>
                </div>
            </div>

            <div class="panel">
                <h3>üí∞ TP / SL</h3>
                <div id="tpsl-panel"></div>
            </div>
        </div>
    </div>

    <script>
        // Symbols list - UPDATED dengan XAUUSD dan US500
        const symbols = [
            { name: 'EURUSD', price: 1.0856 },
            { name: 'GBPUSD', price: 1.2748 },
            { name: 'USDJPY', price: 149.50 },
            { name: 'AUDUSD', price: 0.6580 },
            { name: 'XAUUSD', price: 2785.50 },     // Gold - BARU
            { name: 'US500', price: 5985.30 },       // S&P 500 - BARU
            { name: 'AAPL', price: 238.45 },
            { name: 'MSFT', price: 425.30 },
            { name: 'GOOGL', price: 168.90 },
            { name: 'TSLA', price: 291.25 },
            { name: 'BTC', price: 98245 },
            { name: 'ETH', price: 3520 }
        ];

        // State
        let currentSymbol = 'EURUSD';
        let currentTimeframe = 'Daily';
        const state = {
            EURUSD: { price: 1.0856, candles: [], forming: null, atr: 0.0025, trend: 'Bullish', rsi: 58 },
            GBPUSD: { price: 1.2748, candles: [], forming: null, atr: 0.0035, trend: 'Bullish', rsi: 62 },
            USDJPY: { price: 149.50, candles: [], forming: null, atr: 1.25, trend: 'Neutral', rsi: 52 },
            AUDUSD: { price: 0.6580, candles: [], forming: null, atr: 0.0018, trend: 'Bearish', rsi: 42 },
            XAUUSD: { price: 2785.50, candles: [], forming: null, atr: 15.5, trend: 'Bullish', rsi: 65 },  // Gold
            US500: { price: 5985.30, candles: [], forming: null, atr: 85.0, trend: 'Bullish', rsi: 68 },   // S&P 500
            AAPL: { price: 238.45, candles: [], forming: null, atr: 2.50, trend: 'Bullish', rsi: 65 },
            MSFT: { price: 425.30, candles: [], forming: null, atr: 3.20, trend: 'Bullish', rsi: 68 },
            GOOGL: { price: 168.90, candles: [], forming: null, atr: 1.80, trend: 'Neutral', rsi: 55 },
            TSLA: { price: 291.25, candles: [], forming: null, atr: 4.50, trend: 'Bearish', rsi: 38 },
            BTC: { price: 98245, candles: [], forming: null, atr: 1250, trend: 'Bullish', rsi: 71 },
            ETH: { price: 3520, candles: [], forming: null, atr: 85, trend: 'Bullish', rsi: 64 }
        };

        const canvas = document.getElementById('chart');
        const ctx = canvas.getContext('2d', { alpha: false });
        const DPR = Math.max(1, window.devicePixelRatio || 1);

        let chartOffset = 0;

        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * DPR;
            canvas.height = rect.height * DPR;
            ctx.scale(DPR, DPR);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Initialize symbols
        function initSymbols() {
            symbols.forEach(sym => {
                if (!state[sym.name].candles.length) {
                    let p = sym.price - (sym.price * 0.01);
                    for (let i = 60; i >= 1; i--) {
                        const t = Date.now() - i * 60_000;
                        const o = p;
                        const h = o + (Math.random() * state[sym.name].atr * 0.4);
                        const l = o - (Math.random() * state[sym.name].atr * 0.4);
                        const c = l + Math.random() * (h - l);
                        const v = Math.round(1200000 * (0.8 + Math.random() * 0.4));
                        state[sym.name].candles.push({ t, o, h, l, c, v });
                        p = c;
                    }
                    state[sym.name].price = state[sym.name].candles[state[sym.name].candles.length - 1].c;
                    startNewCandle(sym.name);
                }
            });
        }

        function startNewCandle(sym) {
            const t = Date.now();
            state[sym].forming = { t, o: state[sym].price, h: state[sym].price, l: state[sym].price, c: state[sym].price, v: 0 };
        }

        function gaussian() {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }

        function updateTick() {
            symbols.forEach(sym => {
                const s = state[sym.name];
                const base = s.atr * 0.001;
                const drift = s.trend === 'Bullish' ? 1 : s.trend === 'Bearish' ? -1 : 0;
                const move = gaussian() * base + drift * base * 0.25;
                s.price = Math.max(0, s.price + move);

                const f = s.forming;
                f.h = Math.max(f.h, s.price);
                f.l = Math.min(f.l, s.price);
                f.c = s.price;
                f.v += Math.round(6000 + Math.random() * 5000);

                const elapsed = Date.now() - f.t;
                if (elapsed >= 60_000) {
                    s.candles.push(f);
                    if (s.candles.length > 100) s.candles.shift();
                    startNewCandle(sym.name);
                    s.atr = 0.9 * s.atr + 0.1 * (f.h - f.l);
                }
            });

            document.getElementById('price-label').textContent = state[currentSymbol].price.toFixed(4);
            updateAnalysis();
            render();
        }

        function updateAnalysis() {
            const s = state[currentSymbol];
            const rsi = s.rsi;
            document.getElementById('setup-rsi').textContent = Math.round(rsi);
            document.getElementById('ind-rsi').textContent = Math.round(rsi);
            document.getElementById('setup-trend').textContent = s.trend;
            document.getElementById('ind-macd').textContent = s.trend === 'Bullish' ? 'Bullish' : s.trend === 'Bearish' ? 'Bearish' : 'Neutral';

            // Zones
            const zones = [
                { price: s.price - s.atr, conf: 85, type: 'bullish' },
                { price: s.price - s.atr * 1.5, conf: 72, type: 'bullish' }
            ];
            const zonesHTML = zones.map(z => `<div class="zone-item ${z.type === 'bearish' ? 'bearish' : ''}"><div class="zone-price">${z.price.toFixed(4)}</div><div class="zone-conf">Conf: ${z.conf}%</div></div>`).join('');
            document.getElementById('zones-panel').innerHTML = zonesHTML;

            // TP/SL
            const entry = s.price;
            const sl = s.price - s.atr * 2;
            const tp1 = s.price + s.atr * 1.5;
            const tp2 = s.price + s.atr * 2.5;
            const tp3 = s.price + s.atr * 3.5;
            const tpsHTML = `SL: ${sl.toFixed(4)}<br>TP1: ${tp1.toFixed(4)}<br>TP2: ${tp2.toFixed(4)}<br>TP3: ${tp3.toFixed(4)}`;
            document.getElementById('tpsl-panel').innerHTML = tpsHTML;
        }

        function render() {
            const W = canvas.clientWidth;
            const H = canvas.clientHeight;
            const s = state[currentSymbol];
            
            ctx.fillStyle = '#0f1420';
            ctx.fillRect(0, 0, W, H);

            // Grid
            ctx.strokeStyle = 'rgba(255,255,255,0.08)';
            ctx.lineWidth = 1;
            for (let i = 0; i < 5; i++) {
                const y = Math.round((H - 20) * i / 4) + 10;
                ctx.beginPath();
                ctx.moveTo(8, y);
                ctx.lineTo(W - 8, y);
                ctx.stroke();
            }

            const candles = [...s.candles, s.forming];
            if (!candles.length) return;

            let minPrice = Math.min(...candles.map(c => c.l));
            let maxPrice = Math.max(...candles.map(c => c.h));
            const range = maxPrice - minPrice || 0.0001;
            minPrice -= range * 0.05;
            maxPrice += range * 0.05;

            const chartHeight = H - 20;
            const chartWidth = W - 16;
            const numVisible = Math.min(50, candles.length);
            const candleWidth = Math.max(2, Math.floor(chartWidth / numVisible * 0.7));
            const spacing = Math.ceil(chartWidth / numVisible);

            candles.slice(-numVisible).forEach((candle, i) => {
                const x = 8 + (i + (candles.length - numVisible)) * spacing + spacing / 2;
                if (x < 8 || x > W - 8) return;

                const openY = 10 + chartHeight * (1 - (candle.o - minPrice) / (maxPrice - minPrice));
                const highY = 10 + chartHeight * (1 - (candle.h - minPrice) / (maxPrice - minPrice));
                const lowY = 10 + chartHeight * (1 - (candle.l - minPrice) / (maxPrice - minPrice));
                const closeY = 10 + chartHeight * (1 - (candle.c - minPrice) / (maxPrice - minPrice));

                const color = candle.c >= candle.o ? '#00c851' : '#ff4444';

                // Wick
                ctx.strokeStyle = color;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(x, highY);
                ctx.lineTo(x, lowY);
                ctx.stroke();

                // Body
                ctx.fillStyle = color;
                const bodyTop = Math.min(openY, closeY);
                const bodyHeight = Math.abs(closeY - openY) || 1;
                ctx.fillRect(x - candleWidth / 2, bodyTop, candleWidth, bodyHeight);
            });

            // Current price line
            const priceLine = 10 + chartHeight * (1 - (s.price - minPrice) / (maxPrice - minPrice));
            ctx.strokeStyle = 'rgba(35, 150, 255, 0.5)';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            ctx.beginPath();
            ctx.moveTo(8, priceLine);
            ctx.lineTo(W - 8, priceLine);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // Symbol buttons
        function createSymbolButtons() {
            const bar = document.getElementById('symbol-bar');
            symbols.forEach(sym => {
                const btn = document.createElement('button');
                btn.className = `symbol-btn ${sym.name === currentSymbol ? 'active' : ''}`;
                btn.textContent = sym.name;
                btn.onclick = () => switchSymbol(sym.name);
                bar.appendChild(btn);
            });
        }

        function switchSymbol(sym) {
            currentSymbol = sym;
            document.getElementById('symbol-name').textContent = sym;
            document.querySelectorAll('.symbol-btn').forEach((btn, i) => {
                btn.classList.toggle('active', btn.textContent === sym);
            });
            updateAnalysis();
            render();
        }

        // Timeframe buttons
        document.querySelectorAll('.tf-switch button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tf-switch button').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTimeframe = btn.dataset.tf;
                render();
            });
        });

        // Touch scroll untuk chart
        let touchStartX = 0;
        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });

        canvas.addEventListener('touchmove', (e) => {
            const touchX = e.touches[0].clientX;
            const diff = touchX - touchStartX;
            if (Math.abs(diff) > 5) {
                chartOffset += diff;
                touchStartX = touchX;
                render();
            }
        });

        // Init
        initSymbols();
        createSymbolButtons();
        updateAnalysis();
        render();

        setInterval(updateTick, 1000);
    </script>
</body>
</html>
